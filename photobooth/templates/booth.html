<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PhotoBooth</title>
    <link href="{{ url_for('static', filename='css/tailwind.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/fontawesome.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/fixes.css') }}?v=20250909" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/booth.css') }}" rel="stylesheet">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body class="bg-gradient-to-br from-rose-50 via-pink-50 to-amber-50 min-h-screen overflow-hidden touch-manipulation">
    <!-- Background Decorations -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="absolute -top-4 -left-4 w-16 h-16 md:w-24 md:h-24 bg-rose-200 rounded-full opacity-30 animate-pulse"></div>
        <div class="absolute top-20 right-8 w-12 h-12 md:w-16 md:h-16 bg-pink-200 rounded-full opacity-40 animate-pulse delay-1000"></div>
        <div class="absolute bottom-32 left-8 w-20 h-20 md:w-28 md:h-28 bg-amber-200 rounded-full opacity-25 animate-pulse delay-2000"></div>
        <div class="absolute -bottom-8 -right-8 w-24 h-24 md:w-32 md:h-32 bg-rose-300 rounded-full opacity-20 animate-pulse delay-3000"></div>
    </div>

    <!-- Main Container -->
    <div class="relative z-10 min-h-screen flex flex-col safe-area-inset">
        <!-- Camera Container - Full available space -->
        <div class="flex-1 flex items-center justify-center px-4 py-4" style="padding-bottom: 100px; margin-top: 20px;">
            <!-- Camera Preview - Takes remaining space -->
            <div id="cameraContainer" class="relative w-full max-w-md sm:max-w-lg md:max-w-xl mx-auto" style="aspect-ratio: 4/6; max-height: calc(100vh - 160px);">
                <video id="cameraPreview" 
                       class="w-full h-full rounded-2xl shadow-2xl border-4 border-white bg-gray-800 object-cover"
                       style="z-index: 10; aspect-ratio: 4/6; object-fit: cover;"
                       autoplay muted playsinline>
                </video>
                
                <!-- FRAME OVERLAY CANVAS - LOADS AFTER CAMERA RUNNING -->
                <canvas id="frameOverlayCanvas" 
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 200; pointer-events: none; border-radius: 1rem; opacity: 0; display: none;"
                        width="800" height="1200">
                </canvas>
                
                <!-- Camera Error State -->
                <div id="cameraError" class="absolute inset-0 bg-red-900 rounded-2xl flex items-center justify-center hidden">
                    <div class="text-center px-4">
                        <i class="fas fa-exclamation-triangle text-4xl md:text-6xl text-white mb-3"></i>
                        <p class="text-white text-lg md:text-xl mb-2">Camera Access Required</p>
                        <p class="text-gray-200 text-sm">
                            Please refresh and allow camera access
                        </p>
                    </div>
                </div>

                <!-- Camera Controls Overlay -->
                <div class="absolute top-4 right-4 flex space-x-2">
                    <button id="switchCameraBtn" 
                            class="bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full transition-all duration-200 hidden">
                        <i class="fas fa-sync-alt text-sm"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- FIXED CAPTURE BUTTON - ALWAYS AT BOTTOM -->
        <div class="fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/20 to-transparent backdrop-blur-sm" style="z-index: 200;">
            <div class="max-w-md sm:max-w-lg md:max-w-xl lg:max-w-2xl mx-auto">
                <button id="captureBtn" 
                        class="w-full bg-gradient-to-r from-rose-500 to-pink-500 hover:from-rose-600 hover:to-pink-600
                               active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed
                               text-white font-bold py-4 px-6 rounded-2xl text-lg
                               shadow-2xl transform transition-all duration-200 ease-in-out
                               border-2 border-white hover:border-rose-200 touch-manipulation"
                        style="min-height: 60px;">
                    <i class="fas fa-camera mr-2 text-base"></i>
                    <span id="captureText">Start Photo Session</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Countdown Overlay -->
    <div id="countdownOverlay" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="text-center">
                <div id="countdownNumber" 
                     class="text-white text-[8rem] md:text-[12rem] lg:text-[16rem] font-bold leading-none 
                            animate-pulse drop-shadow-2xl">
                    3
                </div>
                <p class="text-white text-2xl md:text-3xl lg:text-4xl mt-4 animate-bounce">
                    Get Ready! <i class="fas fa-camera ml-2"></i>
                </p>
            </div>
        </div>
    </div>

    <!-- Photo Preview Modal -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-95 z-50 hidden">
        <div class="min-h-screen flex flex-col items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-h-screen overflow-hidden flex flex-col" style="width: 480px; max-width: 95vw;">
                <!-- Modal Header -->
                <div class="bg-gradient-to-r from-rose-500 to-pink-500 text-white p-3 rounded-t-2xl flex-shrink-0">
                    <h2 class="text-lg md:text-xl font-bold text-center flex items-center justify-center">
                        <i class="fas fa-star mr-2 text-yellow-200"></i>
                        How does it look?
                        <i class="fas fa-star ml-2 text-yellow-200"></i>
                    </h2>
                </div>
                
                <!-- Photo Preview - ACTUAL 4x6 SIZE (4" wide x 6" tall at 72dpi = 288x432px) -->
                <div class="flex-1 p-4 flex items-center justify-center" style="min-height: 0;">
                    <div class="bg-white rounded-lg border-2 border-gray-200 shadow-lg" style="width: 400px; height: 600px;">
                        <img id="previewImage" 
                             class="w-full h-full object-contain rounded-lg" 
                             style="width: 400px; height: 600px; background-color: #ffffff;"
                             src="" alt="Photo Preview">
                    </div>
                </div>
                
                <!-- Printer Error Notifications -->
                {% if print_allowance.error_status and print_allowance.error_status.has_errors %}
                <div class="mx-4 mb-3 p-3 bg-red-600 text-white rounded-lg border border-red-700 shadow-lg">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-circle text-xl mr-3"></i>
                        <div class="flex-1">
                            <h3 class="font-bold text-sm">Printer Error</h3>
                            <p class="text-xs opacity-90">{{ print_allowance.error_status.latest_error.error_message if print_allowance.error_status.latest_error else 'Printer has active errors' }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Ink Level Notifications -->
                {% if print_count_status.enabled %}
                    {% if print_count_status.is_empty %}
                    <div class="mx-4 mb-3 p-3 bg-red-500 text-white rounded-lg border border-red-600 shadow-lg">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle text-xl mr-3"></i>
                            <div>
                                <h3 class="font-bold text-sm">Cartridge Empty</h3>
                                <p class="text-xs opacity-90">Printing disabled. Please replace the ink cartridge.</p>
                            </div>
                        </div>
                    </div>
                    {% elif print_count_status.is_low %}
                    <div class="mx-4 mb-3 p-3 bg-yellow-500 text-white rounded-lg border border-yellow-600 shadow-lg">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle text-xl mr-3"></i>
                            <div>
                                <h3 class="font-bold text-sm">Low Ink Warning</h3>
                                <p class="text-xs opacity-90">Only {{ print_count_status.remaining }} prints remaining.</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endif %}
                
                <!-- Action Buttons -->
                <div class="p-4 flex-shrink-0">
                    <div class="flex flex-col space-y-3 md:grid md:grid-cols-3 md:gap-3 md:space-y-0 justify-center">
                        <button id="printBtn" 
                                class="flex-1 
                                       {% if print_allowance.allowed %}bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600{% else %}bg-gray-500 cursor-not-allowed{% endif %}
                                       active:scale-95 text-white font-bold py-4 px-4 md:px-6 rounded-xl text-base md:text-lg
                                       shadow-xl transform transition-all duration-200 ease-in-out
                                       border-2 border-white {% if print_allowance.allowed %}hover:border-green-200{% endif %} touch-manipulation"
                                {% if not print_allowance.allowed %}disabled title="{{ print_allowance.reason }}"{% endif %}>
                            <i class="fas {% if print_allowance.allowed %}fa-print{% else %}fa-ban{% endif %} mr-2"></i>
                            {% if print_allowance.allowed %}Print Photo{% else %}Cannot Print{% endif %}
                        </button>
                        
                        <button id="smsBtn" 
                                class="flex-1 bg-gradient-to-r from-purple-500 to-violet-500 hover:from-purple-600 hover:to-violet-600
                                       active:scale-95 text-white font-bold py-4 px-4 md:px-6 rounded-xl text-base md:text-lg
                                       shadow-xl transform transition-all duration-200 ease-in-out
                                       border-2 border-white hover:border-purple-200 touch-manipulation">
                            <i class="fas fa-sms mr-2"></i>
                            Send SMS
                        </button>
                        
                        <button id="retakeBtn" 
                                class="flex-1 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600
                                       active:scale-95 text-white font-bold py-4 px-4 md:px-6 rounded-xl text-base md:text-lg
                                       shadow-xl transform transition-all duration-200 ease-in-out
                                       border-2 border-white hover:border-amber-200 touch-manipulation">
                            <i class="fas fa-redo mr-2"></i>
                            Take Another
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="text-center">
                <div class="animate-spin rounded-full h-20 w-20 md:h-32 md:w-32 border-4 md:border-8 border-white border-t-rose-500 mx-auto mb-6"></div>
                <p id="loadingText" class="text-white text-lg md:text-2xl">Processing your photo...</p>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="successMessage" 
         class="fixed top-4 md:top-8 left-4 right-4 md:left-1/2 md:right-auto md:transform md:-translate-x-1/2 
                bg-green-500 text-white px-6 py-3 md:px-8 md:py-4 
                rounded-xl md:rounded-full shadow-xl z-50 hidden animate-bounce text-center">
        <i class="fas fa-check-circle mr-2"></i>
        <span id="successText">Photo printed successfully!</span>
    </div>

    <!-- Error Message -->
    <div id="errorMessage" 
         class="fixed top-4 md:top-8 left-4 right-4 md:left-1/2 md:right-auto md:transform md:-translate-x-1/2 
                bg-red-500 text-white px-6 py-3 md:px-8 md:py-4 
                rounded-xl md:rounded-full shadow-xl z-50 hidden text-center">
        <i class="fas fa-exclamation-circle mr-2"></i>
        <span id="errorText">Something went wrong!</span>
    </div>

    <!-- SMS Modal -->
    <div id="smsModal" class="fixed inset-0 bg-black bg-opacity-95 z-50 hidden">
        <div class="min-h-screen flex flex-col items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-h-screen overflow-hidden flex flex-col" style="width: 480px; max-width: 95vw;">
                <!-- Modal Header -->
                <div class="bg-gradient-to-r from-purple-500 to-violet-500 text-white p-4 rounded-t-2xl flex-shrink-0">
                    <h2 class="text-xl font-bold text-center flex items-center justify-center">
                        <i class="fas fa-sms mr-2"></i>
                        Send Photo via SMS
                        <i class="fas fa-sms ml-2"></i>
                    </h2>
                </div>
                
                <!-- SMS Form -->
                <div class="flex-1 p-6">
                    <form id="smsForm" class="space-y-4">
                        <!-- Phone Number Input -->
                        <div>
                            <label for="smsPhoneNumber" class="block text-sm font-medium text-gray-700 mb-2">
                                Phone Number *
                            </label>
                            <div class="flex gap-2">
                                <!-- Country Code Dropdown -->
                                <select id="smsCountryCode" 
                                        name="country_code"
                                        class="px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-lg bg-white">
                                    <option value="+1" data-country="US">🇺🇸 +1</option>
                                    <option value="+44" data-country="GB">🇬🇧 +44</option>
                                    <option value="+33" data-country="FR">🇫🇷 +33</option>
                                    <option value="+49" data-country="DE">🇩🇪 +49</option>
                                    <option value="+39" data-country="IT">🇮🇹 +39</option>
                                    <option value="+34" data-country="ES">🇪🇸 +34</option>
                                    <option value="+81" data-country="JP">🇯🇵 +81</option>
                                    <option value="+86" data-country="CN">🇨🇳 +86</option>
                                    <option value="+91" data-country="IN">🇮🇳 +91</option>
                                    <option value="+61" data-country="AU">🇦🇺 +61</option>
                                    <option value="+55" data-country="BR">🇧🇷 +55</option>
                                    <option value="+52" data-country="MX">🇲🇽 +52</option>
                                    <option value="+7" data-country="RU">🇷🇺 +7</option>
                                    <option value="+82" data-country="KR">🇰🇷 +82</option>
                                    <option value="+31" data-country="NL">🇳🇱 +31</option>
                                    <option value="+46" data-country="SE">🇸🇪 +46</option>
                                    <option value="+47" data-country="NO">🇳🇴 +47</option>
                                    <option value="+45" data-country="DK">🇩🇰 +45</option>
                                    <option value="+358" data-country="FI">🇫🇮 +358</option>
                                    <option value="+41" data-country="CH">🇨🇭 +41</option>
                                    <option value="+43" data-country="AT">🇦🇹 +43</option>
                                    <option value="+32" data-country="BE">🇧🇪 +32</option>
                                    <option value="+351" data-country="PT">🇵🇹 +351</option>
                                    <option value="+30" data-country="GR">🇬🇷 +30</option>
                                    <option value="+48" data-country="PL">🇵🇱 +48</option>
                                    <option value="+420" data-country="CZ">🇨🇿 +420</option>
                                    <option value="+421" data-country="SK">🇸🇰 +421</option>
                                    <option value="+36" data-country="HU">🇭🇺 +36</option>
                                    <option value="+40" data-country="RO">🇷🇴 +40</option>
                                    <option value="+359" data-country="BG">🇧🇬 +359</option>
                                    <option value="+385" data-country="HR">🇭🇷 +385</option>
                                    <option value="+386" data-country="SI">🇸🇮 +386</option>
                                    <option value="+372" data-country="EE">🇪🇪 +372</option>
                                    <option value="+371" data-country="LV">🇱🇻 +371</option>
                                    <option value="+370" data-country="LT">🇱🇹 +370</option>
                                    <option value="+353" data-country="IE">🇮🇪 +353</option>
                                    <option value="+354" data-country="IS">🇮🇸 +354</option>
                                    <option value="+356" data-country="MT">🇲🇹 +356</option>
                                    <option value="+357" data-country="CY">🇨🇾 +357</option>
                                    <option value="+377" data-country="MC">🇲🇨 +377</option>
                                    <option value="+376" data-country="AD">🇦🇩 +376</option>
                                    <option value="+378" data-country="SM">🇸🇲 +378</option>
                                    <option value="+379" data-country="VA">🇻🇦 +379</option>
                                    <option value="+423" data-country="LI">🇱🇮 +423</option>
                                    <option value="+212" data-country="MA">🇲🇦 +212</option>
                                    <option value="+213" data-country="DZ">🇩🇿 +213</option>
                                    <option value="+216" data-country="TN">🇹🇳 +216</option>
                                    <option value="+218" data-country="LY">🇱🇾 +218</option>
                                    <option value="+20" data-country="EG">🇪🇬 +20</option>
                                    <option value="+27" data-country="ZA">🇿🇦 +27</option>
                                    <option value="+234" data-country="NG">🇳🇬 +234</option>
                                    <option value="+254" data-country="KE">🇰🇪 +254</option>
                                    <option value="+256" data-country="UG">🇺🇬 +256</option>
                                    <option value="+255" data-country="TZ">🇹🇿 +255</option>
                                    <option value="+233" data-country="GH">🇬🇭 +233</option>
                                    <option value="+225" data-country="CI">🇨🇮 +225</option>
                                    <option value="+221" data-country="SN">🇸🇳 +221</option>
                                    <option value="+220" data-country="GM">🇬🇲 +220</option>
                                    <option value="+224" data-country="GN">🇬🇳 +224</option>
                                    <option value="+226" data-country="BF">🇧🇫 +226</option>
                                    <option value="+227" data-country="NE">🇳🇪 +227</option>
                                    <option value="+228" data-country="TG">🇹🇬 +228</option>
                                    <option value="+229" data-country="BJ">🇧🇯 +229</option>
                                    <option value="+230" data-country="MU">🇲🇺 +230</option>
                                    <option value="+231" data-country="LR">🇱🇷 +231</option>
                                    <option value="+232" data-country="SL">🇸🇱 +232</option>
                                    <option value="+235" data-country="TD">🇹🇩 +235</option>
                                    <option value="+236" data-country="CF">🇨🇫 +236</option>
                                    <option value="+237" data-country="CM">🇨🇲 +237</option>
                                    <option value="+238" data-country="CV">🇨🇻 +238</option>
                                    <option value="+239" data-country="ST">🇸🇹 +239</option>
                                    <option value="+240" data-country="GQ">🇬🇶 +240</option>
                                    <option value="+241" data-country="GA">🇬🇦 +241</option>
                                    <option value="+242" data-country="CG">🇨🇬 +242</option>
                                    <option value="+243" data-country="CD">🇨🇩 +243</option>
                                    <option value="+244" data-country="AO">🇦🇴 +244</option>
                                    <option value="+245" data-country="GW">🇬🇼 +245</option>
                                    <option value="+246" data-country="IO">🇮🇴 +246</option>
                                    <option value="+248" data-country="SC">🇸🇨 +248</option>
                                    <option value="+249" data-country="SD">🇸🇩 +249</option>
                                    <option value="+250" data-country="RW">🇷🇼 +250</option>
                                    <option value="+251" data-country="ET">🇪🇹 +251</option>
                                    <option value="+252" data-country="SO">🇸🇴 +252</option>
                                    <option value="+253" data-country="DJ">🇩🇯 +253</option>
                                    <option value="+257" data-country="BI">🇧🇮 +257</option>
                                    <option value="+258" data-country="MZ">🇲🇿 +258</option>
                                    <option value="+260" data-country="ZM">🇿🇲 +260</option>
                                    <option value="+261" data-country="MG">🇲🇬 +261</option>
                                    <option value="+262" data-country="RE">🇷🇪 +262</option>
                                    <option value="+263" data-country="ZW">🇿🇼 +263</option>
                                    <option value="+264" data-country="NA">🇳🇦 +264</option>
                                    <option value="+265" data-country="MW">🇲🇼 +265</option>
                                    <option value="+266" data-country="LS">🇱🇸 +266</option>
                                    <option value="+267" data-country="BW">🇧🇼 +267</option>
                                    <option value="+268" data-country="SZ">🇸🇿 +268</option>
                                    <option value="+269" data-country="KM">🇰🇲 +269</option>
                                    <option value="+290" data-country="SH">🇸🇭 +290</option>
                                    <option value="+291" data-country="ER">🇪🇷 +291</option>
                                    <option value="+297" data-country="AW">🇦🇼 +297</option>
                                    <option value="+298" data-country="FO">🇫🇴 +298</option>
                                    <option value="+299" data-country="GL">🇬🇱 +299</option>
                                    <option value="+350" data-country="GI">🇬🇮 +350</option>
                                    <option value="+590" data-country="GP">🇬🇵 +590</option>
                                    <option value="+591" data-country="BO">🇧🇴 +591</option>
                                    <option value="+592" data-country="GY">🇬🇾 +592</option>
                                    <option value="+593" data-country="EC">🇪🇨 +593</option>
                                    <option value="+594" data-country="GF">🇬🇫 +594</option>
                                    <option value="+595" data-country="PY">🇵🇾 +595</option>
                                    <option value="+596" data-country="MQ">🇲🇶 +596</option>
                                    <option value="+597" data-country="SR">🇸🇷 +597</option>
                                    <option value="+598" data-country="UY">🇺🇾 +598</option>
                                    <option value="+599" data-country="AN">🇦🇳 +599</option>
                                    <option value="+500" data-country="FK">🇫🇰 +500</option>
                                    <option value="+501" data-country="BZ">🇧🇿 +501</option>
                                    <option value="+502" data-country="GT">🇬🇹 +502</option>
                                    <option value="+503" data-country="SV">🇸🇻 +503</option>
                                    <option value="+504" data-country="HN">🇭🇳 +504</option>
                                    <option value="+505" data-country="NI">🇳🇮 +505</option>
                                    <option value="+506" data-country="CR">🇨🇷 +506</option>
                                    <option value="+507" data-country="PA">🇵🇦 +507</option>
                                    <option value="+508" data-country="PM">🇵🇲 +508</option>
                                    <option value="+509" data-country="HT">🇭🇹 +509</option>
                                    <option value="+590" data-country="BL">🇧🇱 +590</option>
                                    <option value="+590" data-country="MF">🇲🇫 +590</option>
                                    <option value="+1242" data-country="BS">🇧🇸 +1242</option>
                                    <option value="+1246" data-country="BB">🇧🇧 +1246</option>
                                    <option value="+1264" data-country="AI">🇦🇮 +1264</option>
                                    <option value="+1268" data-country="AG">🇦🇬 +1268</option>
                                    <option value="+1284" data-country="VG">🇻🇬 +1284</option>
                                    <option value="+1340" data-country="VI">🇻🇮 +1340</option>
                                    <option value="+1345" data-country="KY">🇰🇾 +1345</option>
                                    <option value="+1441" data-country="BM">🇧🇲 +1441</option>
                                    <option value="+1473" data-country="GD">🇬🇩 +1473</option>
                                    <option value="+1649" data-country="TC">🇹🇨 +1649</option>
                                    <option value="+1664" data-country="MS">🇲🇸 +1664</option>
                                    <option value="+1670" data-country="MP">🇲🇵 +1670</option>
                                    <option value="+1671" data-country="GU">🇬🇺 +1671</option>
                                    <option value="+1684" data-country="AS">🇦🇸 +1684</option>
                                    <option value="+1721" data-country="SX">🇸🇽 +1721</option>
                                    <option value="+1758" data-country="LC">🇱🇨 +1758</option>
                                    <option value="+1767" data-country="DM">🇩🇲 +1767</option>
                                    <option value="+1784" data-country="VC">🇻🇨 +1784</option>
                                    <option value="+1787" data-country="PR">🇵🇷 +1787</option>
                                    <option value="+1809" data-country="DO">🇩🇴 +1809</option>
                                    <option value="+1829" data-country="DO">🇩🇴 +1829</option>
                                    <option value="+1849" data-country="DO">🇩🇴 +1849</option>
                                    <option value="+1868" data-country="TT">🇹🇹 +1868</option>
                                    <option value="+1869" data-country="KN">🇰🇳 +1869</option>
                                    <option value="+1876" data-country="JM">🇯🇲 +1876</option>
                                    <option value="+1939" data-country="PR">🇵🇷 +1939</option>
                                    <option value="+64" data-country="NZ">🇳🇿 +64</option>
                                    <option value="+63" data-country="PH">🇵🇭 +63</option>
                                    <option value="+65" data-country="SG">🇸🇬 +65</option>
                                    <option value="+66" data-country="TH">🇹🇭 +66</option>
                                    <option value="+60" data-country="MY">🇲🇾 +60</option>
                                    <option value="+62" data-country="ID">🇮🇩 +62</option>
                                    <option value="+84" data-country="VN">🇻🇳 +84</option>
                                    <option value="+856" data-country="LA">🇱🇦 +856</option>
                                    <option value="+855" data-country="KH">🇰🇭 +855</option>
                                    <option value="+95" data-country="MM">🇲🇲 +95</option>
                                    <option value="+880" data-country="BD">🇧🇩 +880</option>
                                    <option value="+94" data-country="LK">🇱🇰 +94</option>
                                    <option value="+960" data-country="MV">🇲🇻 +960</option>
                                    <option value="+977" data-country="NP">🇳🇵 +977</option>
                                    <option value="+975" data-country="BT">🇧🇹 +975</option>
                                    <option value="+92" data-country="PK">🇵🇰 +92</option>
                                    <option value="+93" data-country="AF">🇦🇫 +93</option>
                                    <option value="+98" data-country="IR">🇮🇷 +98</option>
                                    <option value="+964" data-country="IQ">🇮🇶 +964</option>
                                    <option value="+965" data-country="KW">🇰🇼 +965</option>
                                    <option value="+966" data-country="SA">🇸🇦 +966</option>
                                    <option value="+967" data-country="YE">🇾🇪 +967</option>
                                    <option value="+968" data-country="OM">🇴🇲 +968</option>
                                    <option value="+971" data-country="AE">🇦🇪 +971</option>
                                    <option value="+972" data-country="IL">🇮🇱 +972</option>
                                    <option value="+973" data-country="BH">🇧🇭 +973</option>
                                    <option value="+974" data-country="QA">🇶🇦 +974</option>
                                    <option value="+976" data-country="MN">🇲🇳 +976</option>
                                    <option value="+962" data-country="JO">🇯🇴 +962</option>
                                    <option value="+961" data-country="LB">🇱🇧 +961</option>
                                    <option value="+963" data-country="SY">🇸🇾 +963</option>
                                    <option value="+90" data-country="TR">🇹🇷 +90</option>
                                    <option value="+374" data-country="AM">🇦🇲 +374</option>
                                    <option value="+375" data-country="BY">🇧🇾 +375</option>
                                    <option value="+380" data-country="UA">🇺🇦 +380</option>
                                    <option value="+381" data-country="RS">🇷🇸 +381</option>
                                    <option value="+382" data-country="ME">🇲🇪 +382</option>
                                    <option value="+383" data-country="XK">🇽🇰 +383</option>
                                    <option value="+387" data-country="BA">🇧🇦 +387</option>
                                    <option value="+389" data-country="MK">🇲🇰 +389</option>
                                    <option value="+995" data-country="GE">🇬🇪 +995</option>
                                    <option value="+994" data-country="AZ">🇦🇿 +994</option>
                                    <option value="+993" data-country="TM">🇹🇲 +993</option>
                                    <option value="+992" data-country="TJ">🇹🇯 +992</option>
                                    <option value="+996" data-country="KG">🇰🇬 +996</option>
                                    <option value="+998" data-country="UZ">🇺🇿 +998</option>
                                    <option value="+7" data-country="KZ">🇰🇿 +7</option>
                                </select>
                                
                                <!-- Phone Number Input -->
                                <input type="tel" 
                                       id="smsPhoneNumber" 
                                       name="phone_number"
                                       placeholder="(555) 123-4567"
                                       required
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-lg">
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Enter your phone number without the country code</p>
                        </div>
                        
                        <!-- Custom Message Input -->
                        <div>
                            <label for="smsCustomMessage" class="block text-sm font-medium text-gray-700 mb-2">
                                Custom Message (Optional)
                            </label>
                            <textarea id="smsCustomMessage" 
                                      name="message"
                                      rows="3"
                                      placeholder="Add a personal message..."
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none"></textarea>
                        </div>
                        
                        <!-- Service Notice -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <div class="flex items-start">
                                <i class="fas fa-info-circle text-blue-600 text-lg mr-3 mt-0.5"></i>
                                <div class="text-sm text-blue-800">
                                    <p class="font-medium mb-1">How SMS Sharing Works</p>
                                    <p>Your photo will be uploaded to ImgBB (free hosting) and shared via SMS. Images expire automatically after 24 hours for privacy.</p>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Action Buttons -->
                <div class="p-6 pt-0 flex-shrink-0">
                    <div class="flex flex-col space-y-3 md:flex-row md:space-y-0 md:space-x-4">
                        <button type="button" 
                                onclick="closeSmsModal()"
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-times mr-2"></i>
                            Cancel
                        </button>
                        <button type="submit" 
                                form="smsForm"
                                class="flex-1 bg-gradient-to-r from-purple-500 to-violet-500 hover:from-purple-600 hover:to-violet-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-paper-plane mr-2"></i>
                            Send SMS
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/camera-debug.js') }}"></script>
    <script src="{{ url_for('static', filename='js/booth.js') }}"></script>
    <script>
    // CANVAS FRAME OVERLAY LOADS AFTER CAMERA IS RUNNING
    document.addEventListener('DOMContentLoaded', function() {
        console.log('INITIALIZING CANVAS FRAME OVERLAY');
        
        const canvas = document.getElementById('frameOverlayCanvas');
        const ctx = canvas ? canvas.getContext('2d') : null;
        const video = document.getElementById('cameraPreview');
        let frameLoaded = false;
        let frameImage = null;
        
        function loadFrameImage() {
            if (!frameImage) {
                frameImage = new Image();
                frameImage.crossOrigin = 'anonymous';
                frameImage.onload = function() {
                    console.log('FRAME IMAGE LOADED SUCCESSFULLY');
                    drawFrameOnCanvas();
                };
                frameImage.onerror = function() {
                    console.log('FRAME IMAGE FAILED TO LOAD');
                };
                frameImage.src = "{{ url_for('static', filename='frames/current.png') }}?v={{ timestamp }}";
            }
        }
        
        function drawFrameOnCanvas() {
            if (canvas && ctx && frameImage && !frameLoaded) {
                console.log('DRAWING FRAME ON CANVAS');
                
                // Set canvas dimensions to match container
                const containerRect = document.getElementById('cameraContainer').getBoundingClientRect();
                canvas.width = containerRect.width;
                canvas.height = containerRect.height;
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw frame image to fill canvas
                ctx.drawImage(frameImage, 0, 0, canvas.width, canvas.height);
                
                // Show canvas
                canvas.style.display = 'block';
                canvas.style.opacity = '1';
                canvas.style.position = 'absolute';
                canvas.style.top = '0';
                canvas.style.left = '0';
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                canvas.style.zIndex = '200';
                canvas.style.pointerEvents = 'none';
                canvas.style.borderRadius = '1rem';
                
                frameLoaded = true;
                console.log('CANVAS FRAME OVERLAY ACTIVATED');
            }
        }
        
        function enforceCanvasOverlay() {
            if (canvas && frameLoaded) {
                canvas.style.display = 'block';
                canvas.style.opacity = '1';
                canvas.style.position = 'absolute';
                canvas.style.top = '0';
                canvas.style.left = '0';
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                canvas.style.zIndex = '200';
                canvas.style.pointerEvents = 'none';
                canvas.style.borderRadius = '1rem';
            }
        }
        
        // Wait for camera to be fully playing before showing frame
        if (video) {
            video.addEventListener('playing', function() {
                console.log('VIDEO PLAYING EVENT - LOADING FRAME IMAGE');
                // Load frame image first, then it will auto-draw
                setTimeout(loadFrameImage, 500);
            });
        }
        
        // Periodic enforcement only after frame is initially loaded
        setInterval(function() {
            if (frameLoaded) {
                enforceCanvasOverlay();
                // Redraw frame if canvas was cleared
                if (ctx) {
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const isEmpty = !imageData.data.some(channel => channel !== 0);
                    if (isEmpty && frameImage) {
                        console.log('REDRAWING FRAME ON CANVAS');
                        drawFrameOnCanvas();
                    }
                }
            }
        }, 3000);
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (frameLoaded && frameImage && canvas && ctx) {
                console.log('WINDOW RESIZED - REDRAWING CANVAS');
                setTimeout(drawFrameOnCanvas, 100);
            }
        });
        
        console.log('CANVAS FRAME OVERLAY INITIALIZED');
    });
    </script>
</body>
</html>