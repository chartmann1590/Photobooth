<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PhotoBooth</title>
    <link href="{{ url_for('static', filename='css/tailwind.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/fontawesome.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/fixes.css') }}?v=20250909" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/booth.css') }}" rel="stylesheet">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body class="bg-gradient-to-br from-rose-50 via-pink-50 to-amber-50 min-h-screen overflow-hidden touch-manipulation">
    <!-- Background Decorations -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="absolute -top-4 -left-4 w-16 h-16 md:w-24 md:h-24 bg-rose-200 rounded-full opacity-30 animate-pulse"></div>
        <div class="absolute top-20 right-8 w-12 h-12 md:w-16 md:h-16 bg-pink-200 rounded-full opacity-40 animate-pulse delay-1000"></div>
        <div class="absolute bottom-32 left-8 w-20 h-20 md:w-28 md:h-28 bg-amber-200 rounded-full opacity-25 animate-pulse delay-2000"></div>
        <div class="absolute -bottom-8 -right-8 w-24 h-24 md:w-32 md:h-32 bg-rose-300 rounded-full opacity-20 animate-pulse delay-3000"></div>
    </div>

    <!-- Main Container -->
    <div class="relative z-10 min-h-screen flex flex-col safe-area-inset">
        <!-- Camera Container - Full available space -->
        <div class="flex-1 flex items-center justify-center px-4 py-4" style="padding-bottom: 100px; margin-top: 20px;">
            <!-- Camera Preview - Takes remaining space -->
            <div id="cameraContainer" class="relative w-full max-w-md sm:max-w-lg md:max-w-xl mx-auto" style="aspect-ratio: 4/6; max-height: calc(100vh - 160px);">
                <video id="cameraPreview" 
                       class="w-full h-full rounded-2xl shadow-2xl border-4 border-white bg-gray-800 object-cover"
                       style="z-index: 10; aspect-ratio: 4/6; object-fit: cover;"
                       autoplay muted playsinline>
                </video>
                
                <!-- FRAME OVERLAY ON TOP - STRETCHED TO FIT -->
                <img id="frameOverlay" 
                     src="{{ url_for('static', filename='frames/current.png') }}?v={{ timestamp }}" 
                     style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; pointer-events: none; object-fit: fill; border-radius: 1rem;"
                     alt="Frame Overlay"
                     onload="console.log('FRAME LOADED DIRECTLY FROM STATIC');"
                     onerror="console.log('STATIC FRAME FAILED'); this.style.display='none';">
                
                <!-- Camera Error State -->
                <div id="cameraError" class="absolute inset-0 bg-red-900 rounded-2xl flex items-center justify-center hidden">
                    <div class="text-center px-4">
                        <i class="fas fa-exclamation-triangle text-4xl md:text-6xl text-white mb-3"></i>
                        <p class="text-white text-lg md:text-xl mb-2">Camera Access Required</p>
                        <p class="text-gray-200 text-sm">
                            Please refresh and allow camera access
                        </p>
                    </div>
                </div>

                <!-- Camera Controls Overlay -->
                <div class="absolute top-4 right-4 flex space-x-2">
                    <button id="switchCameraBtn" 
                            class="bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full transition-all duration-200 hidden">
                        <i class="fas fa-sync-alt text-sm"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- FIXED CAPTURE BUTTON - ALWAYS AT BOTTOM -->
        <div class="fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/20 to-transparent backdrop-blur-sm" style="z-index: 200;">
            <div class="max-w-md sm:max-w-lg md:max-w-xl lg:max-w-2xl mx-auto">
                <button id="captureBtn" 
                        class="w-full bg-gradient-to-r from-rose-500 to-pink-500 hover:from-rose-600 hover:to-pink-600
                               active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed
                               text-white font-bold py-4 px-6 rounded-2xl text-lg
                               shadow-2xl transform transition-all duration-200 ease-in-out
                               border-2 border-white hover:border-rose-200 touch-manipulation"
                        style="min-height: 60px;">
                    <i class="fas fa-camera mr-2 text-base"></i>
                    <span id="captureText">Start Photo Session</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Countdown Overlay -->
    <div id="countdownOverlay" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="text-center">
                <div id="countdownNumber" 
                     class="text-white text-[8rem] md:text-[12rem] lg:text-[16rem] font-bold leading-none 
                            animate-pulse drop-shadow-2xl">
                    3
                </div>
                <p class="text-white text-2xl md:text-3xl lg:text-4xl mt-4 animate-bounce">
                    Get Ready! <i class="fas fa-camera ml-2"></i>
                </p>
            </div>
        </div>
    </div>

    <!-- Photo Preview Modal -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-95 z-50 hidden">
        <div class="min-h-screen flex flex-col items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-h-screen overflow-hidden flex flex-col" style="width: 480px; max-width: 95vw;">
                <!-- Modal Header -->
                <div class="bg-gradient-to-r from-rose-500 to-pink-500 text-white p-3 rounded-t-2xl flex-shrink-0">
                    <h2 class="text-lg md:text-xl font-bold text-center flex items-center justify-center">
                        <i class="fas fa-star mr-2 text-yellow-200"></i>
                        How does it look?
                        <i class="fas fa-star ml-2 text-yellow-200"></i>
                    </h2>
                </div>
                
                <!-- Photo Preview - ACTUAL 4x6 SIZE (4" wide x 6" tall at 72dpi = 288x432px) -->
                <div class="flex-1 p-4 flex items-center justify-center" style="min-height: 0;">
                    <div class="bg-white rounded-lg border-2 border-gray-200 shadow-lg" style="width: 400px; height: 600px;">
                        <img id="previewImage" 
                             class="w-full h-full object-contain rounded-lg" 
                             style="width: 400px; height: 600px; background-color: #ffffff;"
                             src="" alt="Photo Preview">
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="p-4 flex-shrink-0">
                    <div class="flex flex-col space-y-3 md:flex-row md:space-y-0 md:space-x-4 justify-center">
                        <button id="printBtn" 
                                class="flex-1 md:flex-none bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600
                                       active:scale-95 text-white font-bold py-4 px-6 md:px-8 rounded-xl text-lg
                                       shadow-xl transform transition-all duration-200 ease-in-out
                                       border-2 border-white hover:border-green-200 touch-manipulation">
                            <i class="fas fa-print mr-2"></i>
                            Print Photo
                        </button>
                        
                        <button id="retakeBtn" 
                                class="flex-1 md:flex-none bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600
                                       active:scale-95 text-white font-bold py-4 px-6 md:px-8 rounded-xl text-lg
                                       shadow-xl transform transition-all duration-200 ease-in-out
                                       border-2 border-white hover:border-amber-200 touch-manipulation">
                            <i class="fas fa-redo mr-2"></i>
                            Take Another
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="text-center">
                <div class="animate-spin rounded-full h-20 w-20 md:h-32 md:w-32 border-4 md:border-8 border-white border-t-rose-500 mx-auto mb-6"></div>
                <p id="loadingText" class="text-white text-lg md:text-2xl">Processing your photo...</p>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="successMessage" 
         class="fixed top-4 md:top-8 left-4 right-4 md:left-1/2 md:right-auto md:transform md:-translate-x-1/2 
                bg-green-500 text-white px-6 py-3 md:px-8 md:py-4 
                rounded-xl md:rounded-full shadow-xl z-50 hidden animate-bounce text-center">
        <i class="fas fa-check-circle mr-2"></i>
        <span id="successText">Photo printed successfully!</span>
    </div>

    <!-- Error Message -->
    <div id="errorMessage" 
         class="fixed top-4 md:top-8 left-4 right-4 md:left-1/2 md:right-auto md:transform md:-translate-x-1/2 
                bg-red-500 text-white px-6 py-3 md:px-8 md:py-4 
                rounded-xl md:rounded-full shadow-xl z-50 hidden text-center">
        <i class="fas fa-exclamation-circle mr-2"></i>
        <span id="errorText">Something went wrong!</span>
    </div>

    <script src="{{ url_for('static', filename='js/camera-debug.js') }}"></script>
    <script src="{{ url_for('static', filename='js/booth.js') }}"></script>
    <script>
    // FORCE FRAME OVERLAY TO LOAD NO MATTER WHAT
    document.addEventListener('DOMContentLoaded', function() {
        console.log('FORCING FRAME OVERLAY TO LOAD');
        
        // Method 1: Direct fetch and embed
        fetch('/settings/api/frame/current')
        .then(response => response.blob())
        .then(blob => {
            const url = URL.createObjectURL(blob);
            
            // Apply to div background
            const frameDiv = document.getElementById('frameOverlay');
            if (frameDiv) {
                frameDiv.style.backgroundImage = `url(${url})`;
                frameDiv.style.display = 'block';
                console.log('FRAME APPLIED TO DIV BACKGROUND');
            }
            
            // Apply to img src
            const frameImg = document.getElementById('frameOverlayImg');
            if (frameImg) {
                frameImg.src = url;
                frameImg.style.display = 'block';
                console.log('FRAME APPLIED TO IMG SRC');
            }
        })
        .catch(error => {
            console.error('FRAME LOADING FAILED:', error);
            
            // Fallback: Create a visible red border overlay
            const container = document.getElementById('cameraContainer');
            if (container) {
                const fallback = document.createElement('div');
                fallback.style.cssText = 'position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 10px solid red; box-sizing: border-box; z-index: 100; pointer-events: none;';
                fallback.innerHTML = '<div style="position: absolute; top: 10px; left: 10px; background: red; color: white; padding: 5px; font-size: 12px;">FALLBACK FRAME</div>';
                container.appendChild(fallback);
                console.log('FALLBACK FRAME CREATED');
            }
        });
    });
    </script>
</body>
</html>