<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PhotoBooth</title>
    <link href="{{ url_for('static', filename='css/tailwind.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/fontawesome.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/fixes.css') }}?v=20250909" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/booth.css') }}" rel="stylesheet">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body class="bg-gradient-to-br from-rose-50 via-pink-50 to-amber-50 min-h-screen overflow-hidden touch-manipulation">
    <!-- Background Decorations -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="absolute -top-4 -left-4 w-16 h-16 md:w-24 md:h-24 bg-rose-200 rounded-full opacity-30 animate-pulse"></div>
        <div class="absolute top-20 right-8 w-12 h-12 md:w-16 md:h-16 bg-pink-200 rounded-full opacity-40 animate-pulse delay-1000"></div>
        <div class="absolute bottom-32 left-8 w-20 h-20 md:w-28 md:h-28 bg-amber-200 rounded-full opacity-25 animate-pulse delay-2000"></div>
        <div class="absolute -bottom-8 -right-8 w-24 h-24 md:w-32 md:h-32 bg-rose-300 rounded-full opacity-20 animate-pulse delay-3000"></div>
    </div>

    <!-- Main Container -->
    <div class="relative z-10 min-h-screen flex flex-col safe-area-inset">
        <!-- Camera Container - Full available space -->
        <div class="flex-1 flex items-center justify-center px-4 py-4" style="padding-bottom: 100px; margin-top: 20px;">
            <!-- Camera Preview - Takes remaining space -->
            <div id="cameraContainer" class="relative w-full max-w-md sm:max-w-lg md:max-w-xl mx-auto" style="aspect-ratio: 4/6; max-height: calc(100vh - 160px);">
                <video id="cameraPreview" 
                       class="w-full h-full rounded-2xl shadow-2xl border-4 border-white bg-gray-800 object-cover"
                       style="z-index: 10; aspect-ratio: 4/6; object-fit: cover;"
                       autoplay muted playsinline>
                </video>
                
                <!-- FRAME OVERLAY CANVAS - LOADS AFTER CAMERA RUNNING -->
                <canvas id="frameOverlayCanvas" 
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 200; pointer-events: none; border-radius: 1rem; opacity: 0; display: none;"
                        width="800" height="1200">
                </canvas>
                
                <!-- Camera Error State -->
                <div id="cameraError" class="absolute inset-0 bg-red-900 rounded-2xl flex items-center justify-center hidden">
                    <div class="text-center px-4">
                        <i class="fas fa-exclamation-triangle text-4xl md:text-6xl text-white mb-3"></i>
                        <p class="text-white text-lg md:text-xl mb-2">Camera Access Required</p>
                        <p class="text-gray-200 text-sm">
                            Please refresh and allow camera access
                        </p>
                    </div>
                </div>

                <!-- Camera Controls Overlay -->
                <div class="absolute top-4 right-4 flex space-x-2">
                    <button id="switchCameraBtn" 
                            class="bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full transition-all duration-200 hidden">
                        <i class="fas fa-sync-alt text-sm"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- FIXED CAPTURE BUTTON - ALWAYS AT BOTTOM -->
        <div class="fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/20 to-transparent backdrop-blur-sm" style="z-index: 200;">
            <div class="max-w-md sm:max-w-lg md:max-w-xl lg:max-w-2xl mx-auto">
                <button id="captureBtn" 
                        class="w-full bg-gradient-to-r from-rose-500 to-pink-500 hover:from-rose-600 hover:to-pink-600
                               active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed
                               text-white font-bold py-4 px-6 rounded-2xl text-lg
                               shadow-2xl transform transition-all duration-200 ease-in-out
                               border-2 border-white hover:border-rose-200 touch-manipulation"
                        style="min-height: 60px;">
                    <i class="fas fa-camera mr-2 text-base"></i>
                    <span id="captureText">Start Photo Session</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Countdown Overlay -->
    <div id="countdownOverlay" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="text-center">
                <div id="countdownNumber" 
                     class="text-white text-[8rem] md:text-[12rem] lg:text-[16rem] font-bold leading-none 
                            animate-pulse drop-shadow-2xl">
                    3
                </div>
                <p class="text-white text-2xl md:text-3xl lg:text-4xl mt-4 animate-bounce">
                    Get Ready! <i class="fas fa-camera ml-2"></i>
                </p>
            </div>
        </div>
    </div>

    <!-- Photo Preview Modal -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-95 z-50 hidden">
        <div class="min-h-screen flex flex-col items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-h-screen overflow-hidden flex flex-col" style="width: 480px; max-width: 95vw;">
                <!-- Modal Header -->
                <div class="bg-gradient-to-r from-rose-500 to-pink-500 text-white p-3 rounded-t-2xl flex-shrink-0">
                    <h2 class="text-lg md:text-xl font-bold text-center flex items-center justify-center">
                        <i class="fas fa-star mr-2 text-yellow-200"></i>
                        How does it look?
                        <i class="fas fa-star ml-2 text-yellow-200"></i>
                    </h2>
                </div>
                
                <!-- Photo Preview - ACTUAL 4x6 SIZE (4" wide x 6" tall at 72dpi = 288x432px) -->
                <div class="flex-1 p-4 flex items-center justify-center" style="min-height: 0;">
                    <div class="bg-white rounded-lg border-2 border-gray-200 shadow-lg" style="width: 400px; height: 600px;">
                        <img id="previewImage" 
                             class="w-full h-full object-contain rounded-lg" 
                             style="width: 400px; height: 600px; background-color: #ffffff;"
                             src="" alt="Photo Preview">
                    </div>
                </div>
                
                <!-- Printer Error Notifications -->
                {% if print_allowance.error_status and print_allowance.error_status.has_errors %}
                <div class="mx-4 mb-3 p-3 bg-red-600 text-white rounded-lg border border-red-700 shadow-lg">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-circle text-xl mr-3"></i>
                        <div class="flex-1">
                            <h3 class="font-bold text-sm">Printer Error</h3>
                            <p class="text-xs opacity-90">{{ print_allowance.error_status.latest_error.error_message if print_allowance.error_status.latest_error else 'Printer has active errors' }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Ink Level Notifications -->
                {% if print_count_status.enabled %}
                    {% if print_count_status.is_empty %}
                    <div class="mx-4 mb-3 p-3 bg-red-500 text-white rounded-lg border border-red-600 shadow-lg">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle text-xl mr-3"></i>
                            <div>
                                <h3 class="font-bold text-sm">Cartridge Empty</h3>
                                <p class="text-xs opacity-90">Printing disabled. Please replace the ink cartridge.</p>
                            </div>
                        </div>
                    </div>
                    {% elif print_count_status.is_low %}
                    <div class="mx-4 mb-3 p-3 bg-yellow-500 text-white rounded-lg border border-yellow-600 shadow-lg">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle text-xl mr-3"></i>
                            <div>
                                <h3 class="font-bold text-sm">Low Ink Warning</h3>
                                <p class="text-xs opacity-90">Only {{ print_count_status.remaining }} prints remaining.</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endif %}
                
                <!-- Action Buttons -->
                <div class="p-4 flex-shrink-0">
                    <div class="flex flex-col space-y-3 md:grid md:grid-cols-3 md:gap-3 md:space-y-0 justify-center">
                        <button id="printBtn" 
                                class="flex-1 
                                       {% if print_allowance.allowed %}bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600{% else %}bg-gray-500 cursor-not-allowed{% endif %}
                                       active:scale-95 text-white font-bold py-4 px-4 md:px-6 rounded-xl text-base md:text-lg
                                       shadow-xl transform transition-all duration-200 ease-in-out
                                       border-2 border-white {% if print_allowance.allowed %}hover:border-green-200{% endif %} touch-manipulation"
                                {% if not print_allowance.allowed %}disabled title="{{ print_allowance.reason }}"{% endif %}>
                            <i class="fas {% if print_allowance.allowed %}fa-print{% else %}fa-ban{% endif %} mr-2"></i>
                            {% if print_allowance.allowed %}Print Photo{% else %}Cannot Print{% endif %}
                        </button>
                        
                        <button id="smsBtn" 
                                class="flex-1 bg-gradient-to-r from-purple-500 to-violet-500 hover:from-purple-600 hover:to-violet-600
                                       active:scale-95 text-white font-bold py-4 px-4 md:px-6 rounded-xl text-base md:text-lg
                                       shadow-xl transform transition-all duration-200 ease-in-out
                                       border-2 border-white hover:border-purple-200 touch-manipulation">
                            <i class="fas fa-sms mr-2"></i>
                            Send SMS
                        </button>
                        
                        <button id="retakeBtn" 
                                class="flex-1 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600
                                       active:scale-95 text-white font-bold py-4 px-4 md:px-6 rounded-xl text-base md:text-lg
                                       shadow-xl transform transition-all duration-200 ease-in-out
                                       border-2 border-white hover:border-amber-200 touch-manipulation">
                            <i class="fas fa-redo mr-2"></i>
                            Take Another
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="text-center">
                <div class="animate-spin rounded-full h-20 w-20 md:h-32 md:w-32 border-4 md:border-8 border-white border-t-rose-500 mx-auto mb-6"></div>
                <p id="loadingText" class="text-white text-lg md:text-2xl">Processing your photo...</p>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="successMessage" 
         class="fixed top-4 md:top-8 left-4 right-4 md:left-1/2 md:right-auto md:transform md:-translate-x-1/2 
                bg-green-500 text-white px-6 py-3 md:px-8 md:py-4 
                rounded-xl md:rounded-full shadow-xl z-50 hidden animate-bounce text-center">
        <i class="fas fa-check-circle mr-2"></i>
        <span id="successText">Photo printed successfully!</span>
    </div>

    <!-- Error Message -->
    <div id="errorMessage" 
         class="fixed top-4 md:top-8 left-4 right-4 md:left-1/2 md:right-auto md:transform md:-translate-x-1/2 
                bg-red-500 text-white px-6 py-3 md:px-8 md:py-4 
                rounded-xl md:rounded-full shadow-xl z-50 hidden text-center">
        <i class="fas fa-exclamation-circle mr-2"></i>
        <span id="errorText">Something went wrong!</span>
    </div>

    <!-- SMS Modal -->
    <div id="smsModal" class="fixed inset-0 bg-black bg-opacity-95 z-50 hidden">
        <div class="min-h-screen flex flex-col items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-h-screen overflow-hidden flex flex-col" style="width: 480px; max-width: 95vw;">
                <!-- Modal Header -->
                <div class="bg-gradient-to-r from-purple-500 to-violet-500 text-white p-4 rounded-t-2xl flex-shrink-0">
                    <h2 class="text-xl font-bold text-center flex items-center justify-center">
                        <i class="fas fa-sms mr-2"></i>
                        Send Photo via SMS
                        <i class="fas fa-sms ml-2"></i>
                    </h2>
                </div>
                
                <!-- SMS Form -->
                <div class="flex-1 p-6">
                    <form id="smsForm" class="space-y-4">
                        <!-- Phone Number Input -->
                        <div>
                            <label for="smsPhoneNumber" class="block text-sm font-medium text-gray-700 mb-2">
                                Phone Number *
                            </label>
                            <div class="flex gap-2">
                                <!-- Country Code Dropdown -->
                                <select id="smsCountryCode" 
                                        name="country_code"
                                        class="px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-lg bg-white">
                                    <option value="+1" data-country="US">ðŸ‡ºðŸ‡¸ +1</option>
                                    <option value="+44" data-country="GB">ðŸ‡¬ðŸ‡§ +44</option>
                                    <option value="+33" data-country="FR">ðŸ‡«ðŸ‡· +33</option>
                                    <option value="+49" data-country="DE">ðŸ‡©ðŸ‡ª +49</option>
                                    <option value="+39" data-country="IT">ðŸ‡®ðŸ‡¹ +39</option>
                                    <option value="+34" data-country="ES">ðŸ‡ªðŸ‡¸ +34</option>
                                    <option value="+81" data-country="JP">ðŸ‡¯ðŸ‡µ +81</option>
                                    <option value="+86" data-country="CN">ðŸ‡¨ðŸ‡³ +86</option>
                                    <option value="+91" data-country="IN">ðŸ‡®ðŸ‡³ +91</option>
                                    <option value="+61" data-country="AU">ðŸ‡¦ðŸ‡º +61</option>
                                    <option value="+55" data-country="BR">ðŸ‡§ðŸ‡· +55</option>
                                    <option value="+52" data-country="MX">ðŸ‡²ðŸ‡½ +52</option>
                                    <option value="+7" data-country="RU">ðŸ‡·ðŸ‡º +7</option>
                                    <option value="+82" data-country="KR">ðŸ‡°ðŸ‡· +82</option>
                                    <option value="+31" data-country="NL">ðŸ‡³ðŸ‡± +31</option>
                                    <option value="+46" data-country="SE">ðŸ‡¸ðŸ‡ª +46</option>
                                    <option value="+47" data-country="NO">ðŸ‡³ðŸ‡´ +47</option>
                                    <option value="+45" data-country="DK">ðŸ‡©ðŸ‡° +45</option>
                                    <option value="+358" data-country="FI">ðŸ‡«ðŸ‡® +358</option>
                                    <option value="+41" data-country="CH">ðŸ‡¨ðŸ‡­ +41</option>
                                    <option value="+43" data-country="AT">ðŸ‡¦ðŸ‡¹ +43</option>
                                    <option value="+32" data-country="BE">ðŸ‡§ðŸ‡ª +32</option>
                                    <option value="+351" data-country="PT">ðŸ‡µðŸ‡¹ +351</option>
                                    <option value="+30" data-country="GR">ðŸ‡¬ðŸ‡· +30</option>
                                    <option value="+48" data-country="PL">ðŸ‡µðŸ‡± +48</option>
                                    <option value="+420" data-country="CZ">ðŸ‡¨ðŸ‡¿ +420</option>
                                    <option value="+421" data-country="SK">ðŸ‡¸ðŸ‡° +421</option>
                                    <option value="+36" data-country="HU">ðŸ‡­ðŸ‡º +36</option>
                                    <option value="+40" data-country="RO">ðŸ‡·ðŸ‡´ +40</option>
                                    <option value="+359" data-country="BG">ðŸ‡§ðŸ‡¬ +359</option>
                                    <option value="+385" data-country="HR">ðŸ‡­ðŸ‡· +385</option>
                                    <option value="+386" data-country="SI">ðŸ‡¸ðŸ‡® +386</option>
                                    <option value="+372" data-country="EE">ðŸ‡ªðŸ‡ª +372</option>
                                    <option value="+371" data-country="LV">ðŸ‡±ðŸ‡» +371</option>
                                    <option value="+370" data-country="LT">ðŸ‡±ðŸ‡¹ +370</option>
                                    <option value="+353" data-country="IE">ðŸ‡®ðŸ‡ª +353</option>
                                    <option value="+354" data-country="IS">ðŸ‡®ðŸ‡¸ +354</option>
                                    <option value="+356" data-country="MT">ðŸ‡²ðŸ‡¹ +356</option>
                                    <option value="+357" data-country="CY">ðŸ‡¨ðŸ‡¾ +357</option>
                                    <option value="+377" data-country="MC">ðŸ‡²ðŸ‡¨ +377</option>
                                    <option value="+376" data-country="AD">ðŸ‡¦ðŸ‡© +376</option>
                                    <option value="+378" data-country="SM">ðŸ‡¸ðŸ‡² +378</option>
                                    <option value="+379" data-country="VA">ðŸ‡»ðŸ‡¦ +379</option>
                                    <option value="+423" data-country="LI">ðŸ‡±ðŸ‡® +423</option>
                                    <option value="+212" data-country="MA">ðŸ‡²ðŸ‡¦ +212</option>
                                    <option value="+213" data-country="DZ">ðŸ‡©ðŸ‡¿ +213</option>
                                    <option value="+216" data-country="TN">ðŸ‡¹ðŸ‡³ +216</option>
                                    <option value="+218" data-country="LY">ðŸ‡±ðŸ‡¾ +218</option>
                                    <option value="+20" data-country="EG">ðŸ‡ªðŸ‡¬ +20</option>
                                    <option value="+27" data-country="ZA">ðŸ‡¿ðŸ‡¦ +27</option>
                                    <option value="+234" data-country="NG">ðŸ‡³ðŸ‡¬ +234</option>
                                    <option value="+254" data-country="KE">ðŸ‡°ðŸ‡ª +254</option>
                                    <option value="+256" data-country="UG">ðŸ‡ºðŸ‡¬ +256</option>
                                    <option value="+255" data-country="TZ">ðŸ‡¹ðŸ‡¿ +255</option>
                                    <option value="+233" data-country="GH">ðŸ‡¬ðŸ‡­ +233</option>
                                    <option value="+225" data-country="CI">ðŸ‡¨ðŸ‡® +225</option>
                                    <option value="+221" data-country="SN">ðŸ‡¸ðŸ‡³ +221</option>
                                    <option value="+220" data-country="GM">ðŸ‡¬ðŸ‡² +220</option>
                                    <option value="+224" data-country="GN">ðŸ‡¬ðŸ‡³ +224</option>
                                    <option value="+226" data-country="BF">ðŸ‡§ðŸ‡« +226</option>
                                    <option value="+227" data-country="NE">ðŸ‡³ðŸ‡ª +227</option>
                                    <option value="+228" data-country="TG">ðŸ‡¹ðŸ‡¬ +228</option>
                                    <option value="+229" data-country="BJ">ðŸ‡§ðŸ‡¯ +229</option>
                                    <option value="+230" data-country="MU">ðŸ‡²ðŸ‡º +230</option>
                                    <option value="+231" data-country="LR">ðŸ‡±ðŸ‡· +231</option>
                                    <option value="+232" data-country="SL">ðŸ‡¸ðŸ‡± +232</option>
                                    <option value="+235" data-country="TD">ðŸ‡¹ðŸ‡© +235</option>
                                    <option value="+236" data-country="CF">ðŸ‡¨ðŸ‡« +236</option>
                                    <option value="+237" data-country="CM">ðŸ‡¨ðŸ‡² +237</option>
                                    <option value="+238" data-country="CV">ðŸ‡¨ðŸ‡» +238</option>
                                    <option value="+239" data-country="ST">ðŸ‡¸ðŸ‡¹ +239</option>
                                    <option value="+240" data-country="GQ">ðŸ‡¬ðŸ‡¶ +240</option>
                                    <option value="+241" data-country="GA">ðŸ‡¬ðŸ‡¦ +241</option>
                                    <option value="+242" data-country="CG">ðŸ‡¨ðŸ‡¬ +242</option>
                                    <option value="+243" data-country="CD">ðŸ‡¨ðŸ‡© +243</option>
                                    <option value="+244" data-country="AO">ðŸ‡¦ðŸ‡´ +244</option>
                                    <option value="+245" data-country="GW">ðŸ‡¬ðŸ‡¼ +245</option>
                                    <option value="+246" data-country="IO">ðŸ‡®ðŸ‡´ +246</option>
                                    <option value="+248" data-country="SC">ðŸ‡¸ðŸ‡¨ +248</option>
                                    <option value="+249" data-country="SD">ðŸ‡¸ðŸ‡© +249</option>
                                    <option value="+250" data-country="RW">ðŸ‡·ðŸ‡¼ +250</option>
                                    <option value="+251" data-country="ET">ðŸ‡ªðŸ‡¹ +251</option>
                                    <option value="+252" data-country="SO">ðŸ‡¸ðŸ‡´ +252</option>
                                    <option value="+253" data-country="DJ">ðŸ‡©ðŸ‡¯ +253</option>
                                    <option value="+257" data-country="BI">ðŸ‡§ðŸ‡® +257</option>
                                    <option value="+258" data-country="MZ">ðŸ‡²ðŸ‡¿ +258</option>
                                    <option value="+260" data-country="ZM">ðŸ‡¿ðŸ‡² +260</option>
                                    <option value="+261" data-country="MG">ðŸ‡²ðŸ‡¬ +261</option>
                                    <option value="+262" data-country="RE">ðŸ‡·ðŸ‡ª +262</option>
                                    <option value="+263" data-country="ZW">ðŸ‡¿ðŸ‡¼ +263</option>
                                    <option value="+264" data-country="NA">ðŸ‡³ðŸ‡¦ +264</option>
                                    <option value="+265" data-country="MW">ðŸ‡²ðŸ‡¼ +265</option>
                                    <option value="+266" data-country="LS">ðŸ‡±ðŸ‡¸ +266</option>
                                    <option value="+267" data-country="BW">ðŸ‡§ðŸ‡¼ +267</option>
                                    <option value="+268" data-country="SZ">ðŸ‡¸ðŸ‡¿ +268</option>
                                    <option value="+269" data-country="KM">ðŸ‡°ðŸ‡² +269</option>
                                    <option value="+290" data-country="SH">ðŸ‡¸ðŸ‡­ +290</option>
                                    <option value="+291" data-country="ER">ðŸ‡ªðŸ‡· +291</option>
                                    <option value="+297" data-country="AW">ðŸ‡¦ðŸ‡¼ +297</option>
                                    <option value="+298" data-country="FO">ðŸ‡«ðŸ‡´ +298</option>
                                    <option value="+299" data-country="GL">ðŸ‡¬ðŸ‡± +299</option>
                                    <option value="+350" data-country="GI">ðŸ‡¬ðŸ‡® +350</option>
                                    <option value="+590" data-country="GP">ðŸ‡¬ðŸ‡µ +590</option>
                                    <option value="+591" data-country="BO">ðŸ‡§ðŸ‡´ +591</option>
                                    <option value="+592" data-country="GY">ðŸ‡¬ðŸ‡¾ +592</option>
                                    <option value="+593" data-country="EC">ðŸ‡ªðŸ‡¨ +593</option>
                                    <option value="+594" data-country="GF">ðŸ‡¬ðŸ‡« +594</option>
                                    <option value="+595" data-country="PY">ðŸ‡µðŸ‡¾ +595</option>
                                    <option value="+596" data-country="MQ">ðŸ‡²ðŸ‡¶ +596</option>
                                    <option value="+597" data-country="SR">ðŸ‡¸ðŸ‡· +597</option>
                                    <option value="+598" data-country="UY">ðŸ‡ºðŸ‡¾ +598</option>
                                    <option value="+599" data-country="AN">ðŸ‡¦ðŸ‡³ +599</option>
                                    <option value="+500" data-country="FK">ðŸ‡«ðŸ‡° +500</option>
                                    <option value="+501" data-country="BZ">ðŸ‡§ðŸ‡¿ +501</option>
                                    <option value="+502" data-country="GT">ðŸ‡¬ðŸ‡¹ +502</option>
                                    <option value="+503" data-country="SV">ðŸ‡¸ðŸ‡» +503</option>
                                    <option value="+504" data-country="HN">ðŸ‡­ðŸ‡³ +504</option>
                                    <option value="+505" data-country="NI">ðŸ‡³ðŸ‡® +505</option>
                                    <option value="+506" data-country="CR">ðŸ‡¨ðŸ‡· +506</option>
                                    <option value="+507" data-country="PA">ðŸ‡µðŸ‡¦ +507</option>
                                    <option value="+508" data-country="PM">ðŸ‡µðŸ‡² +508</option>
                                    <option value="+509" data-country="HT">ðŸ‡­ðŸ‡¹ +509</option>
                                    <option value="+590" data-country="BL">ðŸ‡§ðŸ‡± +590</option>
                                    <option value="+590" data-country="MF">ðŸ‡²ðŸ‡« +590</option>
                                    <option value="+1242" data-country="BS">ðŸ‡§ðŸ‡¸ +1242</option>
                                    <option value="+1246" data-country="BB">ðŸ‡§ðŸ‡§ +1246</option>
                                    <option value="+1264" data-country="AI">ðŸ‡¦ðŸ‡® +1264</option>
                                    <option value="+1268" data-country="AG">ðŸ‡¦ðŸ‡¬ +1268</option>
                                    <option value="+1284" data-country="VG">ðŸ‡»ðŸ‡¬ +1284</option>
                                    <option value="+1340" data-country="VI">ðŸ‡»ðŸ‡® +1340</option>
                                    <option value="+1345" data-country="KY">ðŸ‡°ðŸ‡¾ +1345</option>
                                    <option value="+1441" data-country="BM">ðŸ‡§ðŸ‡² +1441</option>
                                    <option value="+1473" data-country="GD">ðŸ‡¬ðŸ‡© +1473</option>
                                    <option value="+1649" data-country="TC">ðŸ‡¹ðŸ‡¨ +1649</option>
                                    <option value="+1664" data-country="MS">ðŸ‡²ðŸ‡¸ +1664</option>
                                    <option value="+1670" data-country="MP">ðŸ‡²ðŸ‡µ +1670</option>
                                    <option value="+1671" data-country="GU">ðŸ‡¬ðŸ‡º +1671</option>
                                    <option value="+1684" data-country="AS">ðŸ‡¦ðŸ‡¸ +1684</option>
                                    <option value="+1721" data-country="SX">ðŸ‡¸ðŸ‡½ +1721</option>
                                    <option value="+1758" data-country="LC">ðŸ‡±ðŸ‡¨ +1758</option>
                                    <option value="+1767" data-country="DM">ðŸ‡©ðŸ‡² +1767</option>
                                    <option value="+1784" data-country="VC">ðŸ‡»ðŸ‡¨ +1784</option>
                                    <option value="+1787" data-country="PR">ðŸ‡µðŸ‡· +1787</option>
                                    <option value="+1809" data-country="DO">ðŸ‡©ðŸ‡´ +1809</option>
                                    <option value="+1829" data-country="DO">ðŸ‡©ðŸ‡´ +1829</option>
                                    <option value="+1849" data-country="DO">ðŸ‡©ðŸ‡´ +1849</option>
                                    <option value="+1868" data-country="TT">ðŸ‡¹ðŸ‡¹ +1868</option>
                                    <option value="+1869" data-country="KN">ðŸ‡°ðŸ‡³ +1869</option>
                                    <option value="+1876" data-country="JM">ðŸ‡¯ðŸ‡² +1876</option>
                                    <option value="+1939" data-country="PR">ðŸ‡µðŸ‡· +1939</option>
                                    <option value="+64" data-country="NZ">ðŸ‡³ðŸ‡¿ +64</option>
                                    <option value="+63" data-country="PH">ðŸ‡µðŸ‡­ +63</option>
                                    <option value="+65" data-country="SG">ðŸ‡¸ðŸ‡¬ +65</option>
                                    <option value="+66" data-country="TH">ðŸ‡¹ðŸ‡­ +66</option>
                                    <option value="+60" data-country="MY">ðŸ‡²ðŸ‡¾ +60</option>
                                    <option value="+62" data-country="ID">ðŸ‡®ðŸ‡© +62</option>
                                    <option value="+84" data-country="VN">ðŸ‡»ðŸ‡³ +84</option>
                                    <option value="+856" data-country="LA">ðŸ‡±ðŸ‡¦ +856</option>
                                    <option value="+855" data-country="KH">ðŸ‡°ðŸ‡­ +855</option>
                                    <option value="+95" data-country="MM">ðŸ‡²ðŸ‡² +95</option>
                                    <option value="+880" data-country="BD">ðŸ‡§ðŸ‡© +880</option>
                                    <option value="+94" data-country="LK">ðŸ‡±ðŸ‡° +94</option>
                                    <option value="+960" data-country="MV">ðŸ‡²ðŸ‡» +960</option>
                                    <option value="+977" data-country="NP">ðŸ‡³ðŸ‡µ +977</option>
                                    <option value="+975" data-country="BT">ðŸ‡§ðŸ‡¹ +975</option>
                                    <option value="+92" data-country="PK">ðŸ‡µðŸ‡° +92</option>
                                    <option value="+93" data-country="AF">ðŸ‡¦ðŸ‡« +93</option>
                                    <option value="+98" data-country="IR">ðŸ‡®ðŸ‡· +98</option>
                                    <option value="+964" data-country="IQ">ðŸ‡®ðŸ‡¶ +964</option>
                                    <option value="+965" data-country="KW">ðŸ‡°ðŸ‡¼ +965</option>
                                    <option value="+966" data-country="SA">ðŸ‡¸ðŸ‡¦ +966</option>
                                    <option value="+967" data-country="YE">ðŸ‡¾ðŸ‡ª +967</option>
                                    <option value="+968" data-country="OM">ðŸ‡´ðŸ‡² +968</option>
                                    <option value="+971" data-country="AE">ðŸ‡¦ðŸ‡ª +971</option>
                                    <option value="+972" data-country="IL">ðŸ‡®ðŸ‡± +972</option>
                                    <option value="+973" data-country="BH">ðŸ‡§ðŸ‡­ +973</option>
                                    <option value="+974" data-country="QA">ðŸ‡¶ðŸ‡¦ +974</option>
                                    <option value="+976" data-country="MN">ðŸ‡²ðŸ‡³ +976</option>
                                    <option value="+962" data-country="JO">ðŸ‡¯ðŸ‡´ +962</option>
                                    <option value="+961" data-country="LB">ðŸ‡±ðŸ‡§ +961</option>
                                    <option value="+963" data-country="SY">ðŸ‡¸ðŸ‡¾ +963</option>
                                    <option value="+90" data-country="TR">ðŸ‡¹ðŸ‡· +90</option>
                                    <option value="+374" data-country="AM">ðŸ‡¦ðŸ‡² +374</option>
                                    <option value="+375" data-country="BY">ðŸ‡§ðŸ‡¾ +375</option>
                                    <option value="+380" data-country="UA">ðŸ‡ºðŸ‡¦ +380</option>
                                    <option value="+381" data-country="RS">ðŸ‡·ðŸ‡¸ +381</option>
                                    <option value="+382" data-country="ME">ðŸ‡²ðŸ‡ª +382</option>
                                    <option value="+383" data-country="XK">ðŸ‡½ðŸ‡° +383</option>
                                    <option value="+387" data-country="BA">ðŸ‡§ðŸ‡¦ +387</option>
                                    <option value="+389" data-country="MK">ðŸ‡²ðŸ‡° +389</option>
                                    <option value="+995" data-country="GE">ðŸ‡¬ðŸ‡ª +995</option>
                                    <option value="+994" data-country="AZ">ðŸ‡¦ðŸ‡¿ +994</option>
                                    <option value="+993" data-country="TM">ðŸ‡¹ðŸ‡² +993</option>
                                    <option value="+992" data-country="TJ">ðŸ‡¹ðŸ‡¯ +992</option>
                                    <option value="+996" data-country="KG">ðŸ‡°ðŸ‡¬ +996</option>
                                    <option value="+998" data-country="UZ">ðŸ‡ºðŸ‡¿ +998</option>
                                    <option value="+7" data-country="KZ">ðŸ‡°ðŸ‡¿ +7</option>
                                </select>
                                
                                <!-- Phone Number Input -->
                                <input type="tel" 
                                       id="smsPhoneNumber" 
                                       name="phone_number"
                                       placeholder="(555) 123-4567"
                                       required
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-lg">
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Enter your phone number without the country code</p>
                        </div>
                        
                        <!-- Custom Message Input -->
                        <div>
                            <label for="smsCustomMessage" class="block text-sm font-medium text-gray-700 mb-2">
                                Custom Message (Optional)
                            </label>
                            <textarea id="smsCustomMessage" 
                                      name="message"
                                      rows="3"
                                      placeholder="Add a personal message..."
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none"></textarea>
                        </div>
                        
                        <!-- Service Notice -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <div class="flex items-start">
                                <i class="fas fa-info-circle text-blue-600 text-lg mr-3 mt-0.5"></i>
                                <div class="text-sm text-blue-800">
                                    <p class="font-medium mb-1">How SMS Sharing Works</p>
                                    <p>Your photo will be uploaded to ImgBB (free hosting) and shared via SMS. Images expire automatically after 24 hours for privacy.</p>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Action Buttons -->
                <div class="p-6 pt-0 flex-shrink-0">
                    <div class="flex flex-col space-y-3 md:flex-row md:space-y-0 md:space-x-4">
                        <button type="button" 
                                onclick="closeSmsModal()"
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-times mr-2"></i>
                            Cancel
                        </button>
                        <button type="submit" 
                                form="smsForm"
                                class="flex-1 bg-gradient-to-r from-purple-500 to-violet-500 hover:from-purple-600 hover:to-violet-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-paper-plane mr-2"></i>
                            Send SMS
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/camera-debug.js') }}"></script>
    <script src="{{ url_for('static', filename='js/booth.js') }}"></script>
    <script>
    // CANVAS FRAME OVERLAY LOADS AFTER CAMERA IS RUNNING
    document.addEventListener('DOMContentLoaded', function() {
        console.log('INITIALIZING CANVAS FRAME OVERLAY');
        
        const canvas = document.getElementById('frameOverlayCanvas');
        const ctx = canvas ? canvas.getContext('2d') : null;
        const video = document.getElementById('cameraPreview');
        let frameLoaded = false;
        let frameImage = null;
        
        function loadFrameImage() {
            if (!frameImage) {
                frameImage = new Image();
                frameImage.crossOrigin = 'anonymous';
                frameImage.onload = function() {
                    console.log('FRAME IMAGE LOADED SUCCESSFULLY');
                    drawFrameOnCanvas();
                };
                frameImage.onerror = function() {
                    console.log('FRAME IMAGE FAILED TO LOAD');
                };
                frameImage.src = "{{ url_for('static', filename='frames/current.png') }}?v={{ timestamp }}";
            }
        }
        
        function drawFrameOnCanvas() {
            if (canvas && ctx && frameImage && !frameLoaded) {
                console.log('DRAWING FRAME ON CANVAS');
                
                // Set canvas dimensions to match container
                const containerRect = document.getElementById('cameraContainer').getBoundingClientRect();
                canvas.width = containerRect.width;
                canvas.height = containerRect.height;
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw frame image to fill canvas
                ctx.drawImage(frameImage, 0, 0, canvas.width, canvas.height);
                
                // Show canvas
                canvas.style.display = 'block';
                canvas.style.opacity = '1';
                canvas.style.position = 'absolute';
                canvas.style.top = '0';
                canvas.style.left = '0';
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                canvas.style.zIndex = '200';
                canvas.style.pointerEvents = 'none';
                canvas.style.borderRadius = '1rem';
                
                frameLoaded = true;
                console.log('CANVAS FRAME OVERLAY ACTIVATED');
            }
        }
        
        function enforceCanvasOverlay() {
            if (canvas && frameLoaded) {
                canvas.style.display = 'block';
                canvas.style.opacity = '1';
                canvas.style.position = 'absolute';
                canvas.style.top = '0';
                canvas.style.left = '0';
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                canvas.style.zIndex = '200';
                canvas.style.pointerEvents = 'none';
                canvas.style.borderRadius = '1rem';
            }
        }
        
        // Wait for camera to be fully playing before showing frame
        if (video) {
            video.addEventListener('playing', function() {
                console.log('VIDEO PLAYING EVENT - LOADING FRAME IMAGE');
                // Load frame image first, then it will auto-draw
                setTimeout(loadFrameImage, 500);
            });
        }
        
        // Periodic enforcement only after frame is initially loaded
        setInterval(function() {
            if (frameLoaded) {
                enforceCanvasOverlay();
                // Redraw frame if canvas was cleared
                if (ctx) {
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const isEmpty = !imageData.data.some(channel => channel !== 0);
                    if (isEmpty && frameImage) {
                        console.log('REDRAWING FRAME ON CANVAS');
                        drawFrameOnCanvas();
                    }
                }
            }
        }, 3000);
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (frameLoaded && frameImage && canvas && ctx) {
                console.log('WINDOW RESIZED - REDRAWING CANVAS');
                setTimeout(drawFrameOnCanvas, 100);
            }
        });
        
        console.log('CANVAS FRAME OVERLAY INITIALIZED');
    });
    </script>
</body>
</html>